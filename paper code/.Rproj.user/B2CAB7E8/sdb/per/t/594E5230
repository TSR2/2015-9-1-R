{
    "contents" : "library(magrittr)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(data.table)\nrequire(devEMF)\n\n###轉換成txt後讀取\npath1='C:/Users/TSR/Desktop/新增資料夾 (2)/各縣市汽車加油站汽柴油銷售統計分析表/asdsd.txt'\ntest=read.table(path1,fill = T,skip = 5)\ntest %>% head \nnames(test)=c('縣市別','x5','x5-x10','x10-x15','x15-x20','x20-x25','x25-x30'\n              ,'x30-x40','x40','total')\nhead(test)\n\n\n####直接讀取csv\npath='C:/Users/TSR/Desktop/新增資料夾 (2)/各縣市汽車加油站汽柴油銷售統計分析表/各縣市當月加油站汽柴油銷售量分析表opendata10403.csv'\naaa=readLines(path,encoding = 'UTF-8')\naaa1=aaa[-c(1:5,28,29)]\naaa2=strsplit(aaa1,split = ',')\n#aaa2[[1]] %>% is\n#創建資料框\ntest1=matrix('0',nrow=22,ncol=10)\nfor (i in 1:22){\n  test1[i,]=aaa2[[i]]\n}\ntest1 %<>% as.data.frame()\ntest1\n###names\ntablename=c('縣市別','x5','x5-x10','x10-x15','x15-x20','x20-x25','x25-x30'\n  ,'x30-x40','x40','total')\n\nnames(test1)=tablename\ntest1\n\n\n\n#############################讀入所有資料\naa1=sprintf('%02d',1:11)\ntt1=paste('各縣市當月加油站汽柴油銷售量分析表opendata104',aa1,'.csv',sep='')\n#######路徑\nrealpath='C:/Users/TSR/Desktop/EDA/各縣市汽車加油站汽柴油銷售統計分析表/'\nallpath=paste(realpath,tt1,sep='')\n\nfor (j in 1:11){\n  aaa=readLines(allpath[j],encoding = 'UTF-8')\n  aaa1=aaa[-c(1:5,28,29)]\n  aaa2=strsplit(aaa1,split = ',')\n  #aaa2[[1]] %>% is\n  #創建資料框\n  test1=matrix('0',nrow=22,ncol=10)\n  for (i in 1:22){\n    test1[i,]=aaa2[[i]]\n  }\n  test1 %<>% as.data.frame(.,stringsAsFactors=F)\n  test1\n  ###names\n  tablename=c('縣市別','x5','x5-x10','x10-x15','x15-x20','x20-x25','x25-x30'\n              ,'x30-x40','x40','total')\n  \n  names(test1)=tablename\n  test1$month=j\n  if(j==1){\n    alldata=test1\n  }else{\n    alldata=rbind(alldata,test1)\n  }\n}\nfor (i in 2:10){\n  alldata[,i]=as.numeric(alldata[,i])\n}\nstr(alldata)\npp2=alldata$縣市別\nfg1=alldata %>% group_by(縣市別) %>% summarise(count=n())\nprint(fg1,n = 23)\nalldata %>% filter(縣市別=='桃園縣')\nalldata %>% filter(縣市別=='桃園市')\npp2[pp2=='桃園縣']='桃園市'\nalldata$縣市別=pp2\n\n#write.csv(x = alldata,row.names = F,fileEncoding = \"UTF-8\",\n#          file='C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/alldata.csv')\n#########################################畫圖分析\n\nsummary(alldata)\n\nalldata %>%　filter(month==1)\nalldata[1,2:9] %>% barplot(height = .) \nparnames=alldata %>% names %>%　'['(2:9)\nbplot=function(x,max=80,las=1){\n  y=x[2:9]\n  if(is.vector(y)) y=t(y)\n  names(y)=parnames\n  barplot(as.matrix(y),main=paste(x[1],x[11],sep='_'),ylim=c(0,max),las=las)\n}\n#pdf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/test.pdf',onefile=T,family=\"GB1\")\n#CairoPDF('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/ro.pdf',family=\"SimHei\")\n#迴圈測試畫單個月份\n#par(mfrow=c(5,5),mar=rep(0.7,4))\n#for (i in 1:22){\n#  bplot(alldata[i,])\n#}\n###向量化畫單個月分\n#pdf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/test2.pdf',onefile=T,family=\"GB1\")\n\n\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/每個縣市一月份.emf')\npar(mfrow=c(5,5),mar=c(2,.5,1,.5))\naa=alldata %>%　filter(month==1) \napply(aa, 1, bplot,las=1)\ndev.off()\n######畫單個城市每個月分\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/臺中每個月.emf')\npar(mfrow=c(3,4),mar=rep(2,4))\nalldata %>% filter(縣市別=='臺中市') %>%\n  group_by(month) %>% do(ss=bplot(.))\ndev.off()\n\n \n###畫每個縣市的加油站數\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/各縣市加油站數.emf')\npar(mfrow=c(1,1),mar=rep(4,4))\naa=alldata %>%　filter(month==1) \np1=aa$total\nnames(p1)=aa$縣市別\nbarplot(p1,main='台灣各個縣市的加油站數',las=2)\ndev.off()\nusemap=alldata %>%　filter(month==1) %>% select(縣市別,total)\n###將全部的月份加總，畫出各縣市的長條圖\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/將各個月分加總.emf')\ng1=alldata %>%　group_by(縣市別) %>% do(aa=colSums(.[2:9]))\npp1=do.call(rbind,g1$aa)\ngsum=cbind(g1[,1],pp1)\npar(mfrow=c(5,5),mar=rep(0.7,4))\napply(gsum,1,bplot,max=1000)\ndev.off()\n\n#####台北市的盒狀圖\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/台北市盒狀圖.emf')\npar(mfrow=c(1,1),mar=rep(3,4))\nalldata %>% filter(縣市別=='臺北市') %>% '['(2:9) %>%   boxplot(main='台北市')\ndev.off()\n#####每個縣市各自的盒狀圖\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/各縣市盒狀圖.emf')\npar(mfrow=c(5,5),mar=rep(0.7,4))\nalldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))\ndev.off()\n#####每個縣市每個月的盒狀圖\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/各縣市每個月的盒狀圖.emf')\npar(mfrow=c(5,5),mar=rep(0.7,4))\nalldata %>% group_by(縣市別) %>% do(dd=boxplot(t(.[,2:9]),main=.[1,1]))\ndev.off()\n####################################################################標準化\nst=function(x){\n  tt=as.numeric(x[2:9])/as.numeric(x[10])\n  dd=c(x[1],tt,x[10:11])\n  names(dd)=names(x)[1:11]\n  t(dd)\n}\n\nff=apply(alldata,1,st)\ntestdata=t(ff) %>% as.data.frame(stringsAsFactors =F)\nnames(testdata)=names(alldata)[1:11]\ntestdata %>% head\nstr(testdata)\nfor (i in 2:11){\n  testdata[,i]=as.numeric(testdata[,i])\n}\nstr(testdata)\n\n###向量化畫單個月分\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/各縣市長條圖-標準化.emf')\npar(mfrow=c(5,5),mar=rep(2,4))\naa=testdata %>%　filter(month==1) \napply(aa, 1, bplot,max=.5)\ndev.off()\n\n#####每個縣市各自的盒狀圖\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/各縣市盒狀圖-標準化.emf')\npar(mfrow=c(5,5),mar=rep(0.7,4))\ntestdata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1],ylim=c(0,0.5)))\n\ndev.off()\n\n\n##########\nif(0){\n  tt=function(x){\n    plot(1,1,xlim=c(1,12),ylim=c(0,1),type='n',main=x[1,1])\n    i<<-i+1\n    #x %>% colwise(lines,.col=2:9,col=i)(.)\n    aa=t(x[,2:9])\n    aa=rbind(aa,2:9)\n    aa %<>% as.data.frame()\n    aa %>% group_by(V11) %>% do(pp=lines(.,col=v11))\n    }\n  i=0\n  par(mfrow=c(5,5),mar=c(1.5,1,1.8,1))\n  testdata %>% group_by(縣市別) %>% do(aa=tt(.))\n}\n##\npar(mfrow=c(5,5),mar=c(1.8,1,1.8,1))\n\nlevel= alldata$縣市別 %>% factor %>% levels\nfor (i in level){\n  plot(1,1,xlim=c(1,12),ylim=c(0,.5),main=i)\n  fdata=testdata %>% filter(縣市別==i)\n  for(j in 2:9){\n    lines(fdata[,j],col=j)\n  }\n}\n#plot(rep(1,4),col=2:5,pch=20,cex=4,axes=F)\n#text(c(1,1.7,2.7,3.7),rep(1.2,8),names(alldata)[2:5])\n#plot(rep(1,4),col=6:9,pch=20,cex=4,axes=F)\n#text(c(1.2,2.2,3.2,4),rep(1.2,8),names(alldata)[6:9])\n\nplot(rep(.5,4),1:4,xlim=c(0,2),ylim=c(0,5),col=2:5,pch=20,cex=3,axes=F)\ntext(rep(1.1,4),1:4,names(alldata)[2:5])\nplot(rep(.5,4),1:4,xlim=c(0,2),ylim=c(0,5),col=6:9,pch=20,cex=3,axes=F)\ntext(rep(1.1,4),1:4,names(alldata)[6:9])\n\npar(mfrow=c(1,1),mar=c(1.8,1,1.8,1))\n\nplot(1,1,xlim=c(1,12),ylim=c(0,2),main='連江縣',type='n')\nfdata=testdata %>% filter(縣市別=='連江縣')\nfor(j in 2:9){\n  lines(fdata[,j],col=j)\n}\n\n\n\n\n#####################################失敗區 會產生奇特的dataframe\nif(0){\n  test4=alldata %>% rowwise() %>% do(ss1=st(.))\n  testdata=do.call(rbind,test4$ss1)\n  testdata=Reduce(rbind,test4$ss1)\n  \n  testdata %>% head\n  testdata %>% is\n  testdata %<>% as.data.frame()\n  testdata %>% is\n  testdata %>% head\n  testdata %>%　dim\n  for (i in 2:10){\n    testdata[,i]=as.numeric(testdata[,i])\n  }\n  names(testdata)=names(alldata)[1:10]\n  str(testdata)\n  summary(testdata)\n  \n  for (i in 2:10){\n    alldata[,i]=as.numeric(alldata[,i])\n  }\n}\n########################################\n\n\n####################################################map\npar(mfrow=c(1,1))\nq3=read.table('c:/Users/TSR/Desktop/104-1-EDA-Quiz1/stat.txt'\n              ,sep='\\t',head=T)\nq3\npackageNames <- c(\"ggplot2\",\"rgeos\", \"maptools\", \"scales\", \"raster\")\nlapply(packageNames, library, character.only=TRUE)\nlibrary(magrittr)\ntwDist0 <- getData('GADM', country='TW', level=0)\ntwDist1 <- getData('GADM', country='TW', level=1)\ntwDist2 <- getData('GADM', country='TW', level=2)\nplot(twDist0)\nplot(twDist1)\nplot(twDist2)\n\n\ntwDist2 <- fortify(twDist2, region = \"NAME_2\")\nhead(twDist2)\ntwDist2 %>% dim \ntwDist2$id %>% unique()\n\nnew=c(\"Yilan\",\"Hualien\",\"Nantou\",\"Pingtung\",\"Miaoli\",\"Taoyuan\",\n      \"Kaohsiung City\",\"Kaohsiung City\",\"Keelung\",\"Yulin\",\"New Taipei City\",\n      \"Hsinchu County\",\"Chiayi County\",\"Changhua\",\"Taichung City\",\"Taichung City\",\n      \"Taipei\",\"Taitung\",\"Tainan City\",\"Tainan City\",\"Penghu\")\nq4=q3\nq4$Area=new\nq4$地區=as.character(q4$地區)\nq5=rbind(q4,c('新竹市','4524.25','Hsinchu City'))\nq5$人口密度=as.numeric(q5$人口密度)\nq5[12:13,1]=c('新竹縣','嘉義縣')\nq5 %>% str\ntwDist2 <- fortify(twDist2, region = \"NAME_2\")#fortify function helps us transform a SpatialPolygonDataFrame into a data frame, which is easier to manipulate.\ntwDist2$id[twDist2$id=='Taichung'] <- 'Taichung City'\ntwDist2$id[twDist2$id=='Tainan'] <- 'Tainan City'\ntwDist2$id[twDist2$id=='Kaohsiung'] <- 'Kaohsiung City'\n\nggplot() + geom_map(data=q5, aes(map_id =Area , fill = 人口密度), map = twDist2) + expand_limits(x = twDist2$long, y = twDist2$lat)\ndistanceCenter <- ddply(twDist2, .(id), summarize, latCenter = mean(lat), longCenter = mean(long))\nggplot() + \n  geom_map(data=q5, aes(map_id = Area , fill = 人口密度), map = twDist2) + \n  expand_limits(x = twDist2$long, y = twDist2$lat) + \n  scale_fill_gradient2(low = \"white\",  mid = \"palevioletred1\", midpoint = mean(q5$'人口密度'), high = muted(\"palevioletred4\"), limits = c(min(q5$'人口密度')-3, max(q5$'人口密度')+3))+\n  geom_text(data = distanceCenter, aes(x = longCenter, y = latCenter, label = id, size = 0.2))+xlab(\"\")+ylab(\"\")+ggtitle(\"Older Population in Taiwan\")\n\nq5\nusemap\nq6=merge(q5,usemap,by.x='地區',by.y='縣市別',all.x=T)\nq6[c(6,8,17,21),4]=c(260,266,308,279)\nq6[c(8,17,21),4]=q6$total[c(7,16,20)]\nq6\nggplot() + geom_map(data=q6, aes(map_id =Area , fill = total), map = twDist2) + expand_limits(x = twDist2$long, y = twDist2$lat)\ndistanceCenter <- ddply(twDist2, .(id), summarize, latCenter = mean(lat), longCenter = mean(long))\ndistanceCenter$latCenter[18]=25\ndistanceCenter$latCenter[13]=24.7\ndistanceCenter$latCenter[21]=24.4\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/全台加油站數量.emf')\nggplot() + \n  geom_map(data=q6, aes(map_id = Area , fill = total), map = twDist2) + \n  expand_limits(x = twDist2$long, y = twDist2$lat) + \n  scale_fill_gradient2(low = \"white\",  mid = \"palevioletred1\", midpoint = mean(q6$total), high = muted(\"palevioletred4\"), limits = c(min(q6$total)-3, max(q6$total)+3))+\n  geom_text(data = distanceCenter[-c(4,9),], aes(x = longCenter, y = latCenter, label = id, size = 0.2))+xlab(\"\")+ylab(\"\")+ggtitle(\"count of gas station in Taiwan\")\n\n\ndev.off()\n\n\ntestdata %>% names\ntestdata1=testdata\ntestdata1$total1=testdata1$`x5`+testdata1$`x5-x10`+testdata1$`x10-x15`+testdata1$`x15-x20`\ntestdata1$total2=testdata1$`x20-x25`+testdata1$`x25-x30`+testdata1$`x30-x40`\ntestdata1$total3=testdata1$x40\nusemap1=testdata1 %>%　filter(month==1) %>% select(縣市別,total1)\nusemap2=testdata1 %>%　filter(month==1) %>% select(縣市別,total2)\nusemap3=testdata1 %>%　filter(month==1) %>% select(縣市別,total3)\n\n\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/低銷售加油站比例圖.emf')\nq7=merge(q5,usemap1,by.x='地區',by.y='縣市別',all.x=T)\nq7[c(8,17,21),4]=q7$total[c(7,16,20)]\nggplot() + \n  geom_map(data=q7, aes(map_id = Area , fill = total1), map = twDist2) + \n  expand_limits(x = twDist2$long, y = twDist2$lat) + \n  scale_fill_gradient2(low = \"white\",  mid = \"palevioletred1\", midpoint = mean(q7$total1), high = muted(\"palevioletred4\"), limits = c(min(q7$total1), max(q7$total1)))+\n  geom_text(data = distanceCenter[-c(4,9),], aes(x = longCenter, y = latCenter, label = id, size = 0.2))+xlab(\"\")+ylab(\"\")+ggtitle(\"count of gas station in Taiwan\")\n\ndev.off()\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/中等銷售加油站比例圖.emf')\nq8=merge(q5,usemap2,by.x='地區',by.y='縣市別',all.x=T)\nq8[c(8,17,21),4]=q8$total[c(7,16,20)]\nggplot() + \n  geom_map(data=q8, aes(map_id = Area , fill = total2), map = twDist2) + \n  expand_limits(x = twDist2$long, y = twDist2$lat) + \n  scale_fill_gradient2(low = \"white\",  mid = \"palevioletred1\", midpoint = mean(q8$total2)+.2, high = muted(\"palevioletred4\"), limits = c(min(q8$total2), max(q8$total2)))+\n  geom_text(data = distanceCenter[-c(4,9),], aes(x = longCenter, y = latCenter, label = id, size = 0.2))+xlab(\"\")+ylab(\"\")+ggtitle(\"median of gas station in Taiwan\")\n\ndev.off()\n\nemf('C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/圖表/高銷售加油站比例圖.emf')\nq9=merge(q5,usemap3,by.x='地區',by.y='縣市別',all.x=T)\nq9[c(8,17,21),4]=q9$total[c(7,16,20)]\n\nggplot() + \n  geom_map(data=q9, aes(map_id = Area , fill = total3), map = twDist2) + \n  expand_limits(x = twDist2$long, y = twDist2$lat) + \n  scale_fill_gradient2(low = \"white\",  mid = \"palevioletred1\", midpoint = mean(q9$total3)+.05, high = muted(\"palevioletred4\"), limits = c(min(q9$total3), max(q9$total3)))+\n  geom_text(data = distanceCenter[-c(4,9),], aes(x = longCenter, y = latCenter+.3, label = id, size = 0.5))+xlab(\"\")+ylab(\"\")+ggtitle(\"high of gas station in Taiwan\")\n\n\ndev.off()\n\n",
    "created" : 1454496302638.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "676608405",
    "id" : "594E5230",
    "lastKnownWriteTime" : 1452176276,
    "path" : "C:/Users/TSR/Desktop/EDA/R val final.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}