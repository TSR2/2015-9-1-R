createh(data1=total,com=1)
library(plyr)
library(dplyr)
library(magrittr)
createh(data1=total,com=1)
for (j in 1:2){
if(j==1) {
par(mfcol=c(30,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=total,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:30){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
test3=iris
gr=list(1:50,51:100,101:150)
length(gr)
point_to_h=function(x,group){
d=dim(x)
h=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
h[[j]][[i]]=hist(x[group[[1]],j])
}
}
}
point_to_h=function(x,group){
d=dim(x)
h=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
h[[j]][[i]]=hist(x[group[[1]],j])
}
}
h
}
point_to_h(iris[,1:4],group=gr)
x=iris[,1:4]
group=gr
d=dim(x)
d
h=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
h[[j]][[i]]=hist(x[group[[1]],j])
}
}
length(group)
d[2])
d[2]
i
j
h
h[[1]][[1]]=2
x=iris[,1:4]
group=gr
d=dim(x)
h=list()
a=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
a[[i]]=hist(x[group[[i]],j])
}
h[[j]]=a
}
h
par(mfcol=c(4,3))
point_to_h(iris[,1:4],group=gr)
point_to_h=function(x,group){
d=dim(x)
h=list()
a=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
a[[i]]=hist(x[group[[i]],j])
}
h[[j]]=a
}
h
}
par(mfcol=c(4,3))
point_to_h(iris[,1:4],group=gr)
point_to_h=function(x,group){
d=dim(x)
h=list()
a=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
a[[i]]=hist(x[group[[i]],j])
}
h[[j]]=a
}
h
}
par(mfcol=c(3,4))
point_to_h(iris[,1:4],group=gr)
test4=point_to_h(iris[,1:4],group=gr)
dda=createh(data1=test4,com=j)
dda
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
expand.grid(1:4,2:9)
iris[,1:4],group=gr
test4
point_to_h=function(x,group){
d=dim(x)
h=list()
a=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
ff=hist(x[group[[i]],j])
ff$breaks=ff$breaks/sum(ff$breaks)
a[[i]]=ff
}
h[[j]]=a
}
h
}
par(mfcol=c(3,4))
test4=point_to_h(iris[,1:4],group=gr)
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
test4
point_to_h=function(x,group){
d=dim(x)
h=list()
a=list()
for ( j in 1:d[2]){
for(i in 1:length(group)){
ff=hist(x[group[[i]],j])
ff$counts=ff$counts/sum(ff$counts)
a[[i]]=ff
}
h[[j]]=a
}
h
}
par(mfcol=c(3,4))
test4=point_to_h(iris[,1:4],group=gr)
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
test4
dda1=createh(data1=test4,com=1)
dda2=createh(data1=test4,com=2)
dda1
b1=list(breaks=dda1[[1]][[1]],counts=dda1[[2]][[1]])
b2=list(breaks=dda2[[1]][[1]],counts=dda2[[2]][[1]])
b1
expand.grid(b1$breaks,b2$breaks)
expand.grid(-4:4,2:12)
-4:4
b1
b2
b1=list(breaks=dda1[[1]][[1]],counts=dda1[[2]][[1]])
b2=list(breaks=dda2[[1]][[1]],counts=dda2[[2]][[1]])
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[i+1]-yr[i])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i],0)
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j],0)
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
joint
length(yr)-1
length(xr)-1
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i],0)
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j],0)
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
joint
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i],0)
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j],0)
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=abs((aa*bb)/allrange)
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
joint
image(joint)
sum(joint)
joint=joint/sum(joint)
image(joint)
b1
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=abs((aa*bb)/allrange)
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
joint=joint/sum(joint)
image(joint)
par(mrfow=c(1,1))
par(mfrow=c(1,1))
image(joint)
joint
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=abs((aa*bb)/allrange)
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
lastjoint=lastjoint+joint
}
lastjoint=lastjoint/sum(lastjoint)
image(lastjoint)
dda1
lastjoint
lastjoint=lastjoint/sum(lastjoint)
image(lastjoint)
GBRcol=color.Palette(low='green',mid='black',high='red')
color.Palette <- function(low = "black",
high = c("green", "red"),
mid="black",
k =50)
{
low <- col2rgb(low)/255
high <- col2rgb(high)/255
if(is.null(mid)){
r <- seq(low[1], high[1], len = k)
g <- seq(low[2], high[2], len = k)
b <- seq(low[3], high[3], len = k)
}
if(!is.null(mid)){
k2 <- round(k/2)
mid <- col2rgb(mid)/255
r <- c(seq(low[1], mid[1], len = k2),
seq(mid[1], high[1], len = k2))
g <- c(seq(low[2], mid[2], len = k2),
seq(mid[2], high[2], len = k2))
b <- c(seq(low[3], mid[3], len = k2),
seq(mid[3], high[3], len = k2))
}
rgb(r, g, b)
}
GBRcol=color.Palette(low='green',mid='black',high='red')
image(lastjoint,col=GBRcol)
lastjoint
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=abs((aa*bb)/allrange)
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
lastjoint=lastjoint+joint
}
lastjoint
joint
image(lastjoint,col=GBRcol)
lastjoint
GBRcol=color.Palette(low='green',mid='black',high='red')
image(lastjoint,col=GBRcol)
image(log(lastjoint),col=GBRcol)
image(lastjoint,col=GBRcol)
lastjoint
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=-4:4
xr=2:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
lastjoint=lastjoint+joint
}
lastjoint
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
test4
point_to_h(iris[,1:4],group=gr)
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
dda
dda1
dda2
dda1
for (j in 1:2){
if(j==1) {
par(mfcol=c(30,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=total,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:30){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
