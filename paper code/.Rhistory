eig=eigen(t1)
plot(p %*% eig$vectors[,2],p %*% eig$vectors[,1],col=rep(1:3,each=50))
dr1=p %*% eig$vectors[,1]
dr2=p %*% eig$vectors[,2]
test2=cbind(dr1,dr2)
image(des_e(test2,b=10))
par(mfrow=c(1,1))
test1=kmeans(iris[,1:4],centers = 3)
test1 %>% names()
test1$centers
p=iris[,1:4] %>% as.matrix()
t1=t(p) %*% p
eig=eigen(t1)
plot(p %*% eig$vectors[,2],p %*% eig$vectors[,1],col=rep(1:3,each=50))
image(des_e(test2,b=10))
des_e(test2,b=10)
for (j in 1:2){
if(j==1) {
par(mfcol=c(3,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=test4,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:3){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=-4:4
xr=3:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
GBRcol=color.Palette(low='green',mid='black',high='red')
for ( i in 1:3){
image(part[[i]])
}
image(lastjoint)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=3:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
GBRcol=color.Palette(low='green',mid='black',high='red')
for ( i in 1:3){
image(part[[i]])
}
image(lastjoint)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=3:12
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=seq(3,12,by=.5)
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
lastjoint
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=seq(3,12,by=.5)
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=seq(3,12,by=.5)
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
yr=seq(-4,4,by=.5)
xr=seq(4,12,by=.5)
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
yr=seq(-4,4,by=.5)
xr=seq(4,12,by=.5)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
image(des_e(test2,b=10))
yr=seq(-4,4,by=.1)
xr=seq(4,12,by=.1)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:3){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
lastjoint
image(lastjoint)
dda1
unlist(dda1[[1]])
test4
dda1
dim(dda2)
length(dda2[[1]])
plotjointh=function(x,b){
dda1=createh(data1=x,com=1)
dda2=createh(data1=x,com=2)
xmax=dda1[[1]] %>% unlist %>% max
xmin=dda1[[1]] %>% unlist %>% min
ymax=dda2[[1]] %>% unlist %>% max
ymin=dda2[[1]] %>% unlist %>% min
xr=seq(xmin,xmax,length.out = b)
yr=seq(ymin,ymax,length.out = b)
lastjoint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
part=list()
for (s in 1:length(dda1[[1]])){
b1=list(breaks=dda1[[1]][[s]],counts=dda1[[2]][[s]])
b2=list(breaks=dda2[[1]][[s]],counts=dda2[[2]][[s]])
joint=matrix(0,ncol=(length(yr)-1),nrow=(length(xr)-1))
for (j in 1:(length(yr)-1)){
for (i in 1:(length(xr)-1)){
gg=0
allrange=(xr[i+1]-xr[i])*(yr[j+1]-yr[j])
for(p in 1:length(b1$counts)){
for(k in 1:length(b2$counts)){
aa=min(xr[i+1]-b1$breaks[p],b1$breaks[p+1]-xr[i])
if (aa<0) aa=0
bb=min(yr[j+1]-b2$breaks[k],b2$breaks[k+1]-yr[j])
if (bb<0) bb=0
if (b1$breaks[p]>=xr[i] & b1$breaks[p+1]<=xr[i+1]) aa=b1$breaks[p+1]-b1$breaks[p]
if (b1$breaks[p]<=xr[i] & b1$breaks[p+1]>=xr[i+1]) aa=xr[i+1]-xr[i]
if (b2$breaks[k]>=yr[j] & b2$breaks[k+1]<=yr[j+1]) bb=b2$breaks[k+1]-b2$breaks[k]
if (b2$breaks[k]<=yr[j] & b2$breaks[k+1]>=yr[j+1]) bb=yr[j+1]-yr[j]
coverratio=(aa*bb)/allrange
gg=gg+coverratio*b1$counts[p]*b2$counts[k]
}
}
joint[i,j]=gg
}
}
part[[s]]=joint
lastjoint=lastjoint+joint
}
par(mfrow=c(1,1))
image(lastjoint)
}
plotjointh(test4,10)
test4
plotcom=function(x){
n=length(x[[1]])
p=length(x)
for (j in 1:2){
if(j==1) {
par(mfcol=c(n,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=total,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:p){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
}
plotcom=function(x){
n=length(x[[1]])
p=length(x)
for (j in 1:2){
if(j==1) {
par(mfcol=c(n,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=x,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:p){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
}
plotcom(total)
total
x=total
n=length(x[[1]])
p=length(x)
n
p
plotcom=function(x){
n=length(x[[1]])
p=length(x)
for (j in 1:2){
if(j==1) {
par(mfcol=c(n,2),mai=c(0,0,0,0))
kk=hist(iris[,1],plot=F)
}
dda=createh(data1=x,com=j)
tt=laply(dda[[1]],max)
bma=max(tt)
tt=laply(dda[[1]],min)
bmi=min(tt)
tt=laply(dda[[2]],max)
pma=max(tt)
tt=laply(dda[[2]],min)
pmi=min(tt)
for (i in 1:n){
kk$breaks=dda[[1]][[i]]
kk$counts=dda[[2]][[i]]
plot(kk,xlim=c(bmi-2,bma+1),ylim=c(0,pma),main="",col="blue",ylab = "")
}
}
}
plotcom(total)
plotcom(test4)
plotcom(total)
par(mfrow=c(1,1))
test1=kmeans(iris[,1:4],centers = 3)
test1 %>% names()
test1$centers
p=iris[,1:4] %>% as.matrix()
t1=t(p) %*% p
eig=eigen(t1)
plot(p %*% eig$vectors[,2],p %*% eig$vectors[,1],col=rep(1:3,each=50))
dr1=p %*% eig$vectors[,1]
dr2=p %*% eig$vectors[,2]
test2=cbind(dr1,dr2)
image(des_e(test2,b=10))
test3=iris
gr=list(1:50,51:100,101:150)
par(mfcol=c(3,4))
test4=point_to_h(iris[,1:4],group=gr)
#####################取兩個主成分畫出來
plotcom(test4)
plotjointh(test4,10)
