x=setDT(x)
x[1,v1=1]
x[1,v1:=1]
x
x=iris
names(x) <- paste('v',1:5,sep="")
x[1,v1:=1]
x
by(x,x$v5)
by(x,x$v5,mean(v1))
by(x,x$v5,mean(x$v1))
by(x,x$v5,FUN=mean(x$v1))
by(x,x$v5,function(x) mean(x$v1))
p=by(x,x$v5,function(x) mean(x$v1))
is(p)
p[[1]]
p=with(x,by(x,v5,function(x) mean(v1)))
p[[1]]
his
his[[1]]=1:12
his[[2]]=1:11
his
plot(his)
cal=function(x){
b=length(x[[1]])-1
a=x[[2]]*(x[[1]][2:(b+1)]+x[[1]][1:b])
sum(a)
}
n=length(total[[1]])
mu=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(2*n)
mu=c(mu,m)
}
mu
cal=function(x){
b=length(x[[1]])-1
#parta=x[[2]]*(x[[1]][2:(b+1)]-x[[1]][1:b])^2
parta=x[[2]]*(x[[1]][1:b]^2  +  x[[1]][1:b]*x[[1]][2:(b+1)]  +  x[[1]][2:(b+1)]^2)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
var=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]^2+
total[[j]][[i]][[1]][2:(b+1)]*total[[j]][[i]][[1]][1:b]+
total[[j]][[i]][[1]][1:b]^2)
sum=sum+sum(a)
}
var=c(var,sum/(3*i))
}
var
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[,j])
a[[i]] <- his
}
total[[j]] <- a
}
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
for (b in 1:(length(total[[j]][[i]][[1]])-1)){
a=total[[j]][[i]][[2]][b]*(total[[j]][[i]][[1]][b+1]+total[[j]][[i]][[1]][b])
sum=a+sum
}
}
mu=c(mu,sum/(2*i))
}
mu
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]+total[[j]][[i]][[1]][1:b])
sum=sum+sum(a)
}
mu=c(mu,sum/(2*i))
}
mu
cal=function(x){
b=length(x[[1]])-1
a=x[[2]]*(x[[1]][2:(b+1)]+x[[1]][1:b])
sum(a)
}
n=length(total[[1]])
mu=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(2*n)
mu=c(mu,m)
}
mu
cal=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2  +  x[[1]][1:b]*x[[1]][2:(b+1)]  +  x[[1]][2:(b+1)]^2)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(3*n)
EX2=c(EX2,m)
}
EX2
var=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]^2+
total[[j]][[i]][[1]][2:(b+1)]*total[[j]][[i]][[1]][1:b]+
total[[j]][[i]][[1]][1:b]^2)
sum=sum+sum(a)
}
var=c(var,sum/(3*i))
}
var
EX2=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]^2+
total[[j]][[i]][[1]][2:(b+1)]*total[[j]][[i]][[1]][1:b]+
total[[j]][[i]][[1]][1:b]^2)
sum=sum+sum(a)
}
EX2=c(EX2,sum/(3*i))
}
EX2
his
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[sample(x=1:150,50),j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
for (b in 1:(length(total[[j]][[i]][[1]])-1)){
a=total[[j]][[i]][[2]][b]*(total[[j]][[i]][[1]][b+1]+total[[j]][[i]][[1]][b])
sum=a+sum
}
}
mu=c(mu,sum/(2*i))
}
mu
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]+total[[j]][[i]][[1]][1:b])
sum=sum+sum(a)
}
mu=c(mu,sum/(2*i))
}
mu
cal=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2  +  x[[1]][1:b]*x[[1]][2:(b+1)]  +  x[[1]][2:(b+1)]^2)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
EX2=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]^2+
total[[j]][[i]][[1]][2:(b+1)]*total[[j]][[i]][[1]][1:b]+
total[[j]][[i]][[1]][1:b]^2)
sum=sum+sum(a)
}
EX2=c(EX2,sum/(3*i))
}
EX2
cal=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2  +  x[[1]][1:b]*x[[1]][2:(b+1)]  +  x[[1]][2:(b+1)]^2)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
par(mfrow=c(6,4),mai=c(0,0,0,0))
for (j in 1:4){
for (i in 1:30){
plot(total[[j]][[i]],main = "",xlab = "",ylab = "")
}
}
his
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[sample(x=1:150,50),j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[,j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
for (b in 1:(length(total[[j]][[i]][[1]])-1)){
a=total[[j]][[i]][[2]][b]*(total[[j]][[i]][[1]][b+1]+total[[j]][[i]][[1]][b])
sum=a+sum
}
}
mu=c(mu,sum/(2*i))
}
mu
mu=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]+total[[j]][[i]][[1]][1:b])
sum=sum+sum(a)
}
mu=c(mu,sum/(2*i))
}
mu
cal=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2  +  x[[1]][1:b]*x[[1]][2:(b+1)]  +  x[[1]][2:(b+1)]^2)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
EX2=c()
for (j in 1:4){
sum=0
for (i in 1:30){
b=length(total[[j]][[i]][[1]])-1
a=total[[j]][[i]][[2]]*(total[[j]][[i]][[1]][2:(b+1)]^2+
total[[j]][[i]][[1]][2:(b+1)]*total[[j]][[i]][[1]][1:b]+
total[[j]][[i]][[1]][1:b]^2)
sum=sum+sum(a)
}
EX2=c(EX2,sum/(3*i))
}
EX2
var=EX2-mu^2
var
cov=matrix(0,ncol=4,nrow=4)
library(plyr)
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[sample(x=1:150,50),j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
cal=function(x){
b=length(x[[1]])-1
a=x[[2]]*(x[[1]][2:(b+1)]+x[[1]][1:b])
sum(a)
}
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
calEX=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2
+  x[[1]][1:b]*x[[1]][2:(b+1)]
+  x[[1]][2:(b+1)]^2
)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],calEX))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[,j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
total
sum(m1)*sum(m2)
sum(m1)*sum(m2)/(4*n^2)
sum(m1*m2)/(4*n)
a=list()
total=list()
for (j in 1:4){
for (i in 1:30){
his <- hist(iris[sample(x=1:150,50),j])
his$counts <- his$counts/sum(his$counts)
a[[i]] <- his
}
total[[j]] <- a
}
View(cal)
View(calEX)
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
cal=function(x){
b=length(x[[1]])-1
a=x[[2]]*(x[[1]][2:(b+1)]+x[[1]][1:b])
sum(a)
}
n=length(total[[1]])
mu=c()
for (j in 1:4){
m=sum(sapply(total[[j]],cal))/(2*n)
mu=c(mu,m)
}
mu
calEX=function(x){
b=length(x[[1]])-1
parta=x[[2]]*(x[[1]][1:b]^2
+  x[[1]][1:b]*x[[1]][2:(b+1)]
+  x[[1]][2:(b+1)]^2
)
sum(parta)
}
n=length(total[[1]])
EX2=c()
for (j in 1:4){
m=sum(sapply(total[[j]],calEX))/(3*n)
EX2=c(EX2,m)
}
EX2
var=EX2-mu^2
var
cov=matrix(0,ncol=4,nrow=4)
for (i in 1:4){
m1=laply(total[[i]],cal)
for (j in 1:4){
m2=laply(total[[j]],cal)
cov[i,j]=sum(m1*m2)/(4*n)-sum(m1)*sum(m2)/(4*n^2)
}
}
cov
eigen(cov)
cov
eigen(cov)
library(magrittr)
library(plyr)
library(dplyr)
library(data.table)
library(lattice)
library(ggplot2)
index="c:/Users/tsr/Desktop/上課用檔案/資料視覺化/DoubsFishData"
c=list.files(index,full.names = T)
c
vv=list.files(c[6],full.names = T)
env=read.csv(file=vv[1],row.names = 1)
spe=read.csv(file=vv[3],row.names = 1)
spa=read.csv(file=vv[2],row.names = 1)
index
source('c:/Users/tsr/Desktop/上課用檔案/資料視覺化/DoubsFishData/panelutils.R')
spe[1:5,1:10]
colnames(spe)
summary(spe)
range(spe)
par(mfrow=c(1,1))
pp=stack(spe)
names(pp)=c("v1","v2")
pp
boxplot(v1~v2,data=pp)
spe==0
?summ
?sum
sum(1:2, 3:5)
total0/(dim(spe)[1]*dim(spe)[2])
total0=sum(spe==0)
total0/(dim(spe)[1]*dim(spe)[2])
plot(spa,asp=1,type="n",main='ll')
lines(spa,col="blue")
plot(spa,asp=1,type="l",main='ll')
plot(spa,asp=1,type="l",main='ll')
lines(spa,col="blue")
text(spa,row.names(spa),cex=0.8,col="red")
spa
par(mfrow=c(1,4))
plot(spa,asp=1,col="brown",cex=spe$TRU)
lines(spa,col="blue",lwd=2)
plot(spa,asp=1,col="brown",cex=spe$OMB)
lines(spa,col="blue",lwd=2)
plot(spa,asp=1,col="brown",cex=spe$BAR)
lines(spa,col="blue",lwd=2)
plot(spa,asp=1,col="brown",cex=spe$BCO)
lines(spa,col="blue",lwd=2)
su=apply(spe>0,2,sum)
sort(su)
per=100*su/nrow(spe)
per %>% sort()
per %>% sort() %>% round(.,1)
?round
round(1.1)
round(1.3)
round(1.9)
round(1.5)
round(1.49)
