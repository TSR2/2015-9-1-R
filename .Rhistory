if(is.na(dim(y)[1])){y=t(y)}
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],x[11],sep='_'),ylim=c(0,80))
}
apply(aa, 1,bplot)
alldata[1,] %>% dim
alldata[1,] %>% is.vector()
bplot=function(x){
y=x[2:9]
if(is.vector(y)) y=t(y)
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],x[11],sep='_'),ylim=c(0,80))
}
apply(aa, 1,bplot)
par(mfrow=c(5,5),mar=rep(0.7,4))
apply(aa, 1,bplot)
par(mfrow=c(5,5),mar=rep(0.7,4))
apply(aa, 1,bplot)
par(mfrow=c(5,5),mar=rep(0.7,4))
for (i in 1:22){
bplot(alldata[i,])
}
alldata
write.csv(x = alldata,file='C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/alldata.csv')
apply(aa, 1,bplot)
par(mfrow=c(5,5),mar=rep(0.7,4))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot)
aa
aa %>% colSums()
aa[,2:9] %>% colSums()
aa
aa[,2:9]
aa[,2] %>% is
aa[,2:9] %>% colSums()
aa[,2:9] %>%as.numeric()%>%   colSums()
aa[,2:9] %>%as.numeric()
aa[,2:9]
aa[,2] %>% as.numeric()
aa[,2]
alldata[,2]
?as.data.frame
aa1=sprintf('%02d',1:11)
tt1=paste('各縣市當月加油站汽柴油銷售量分析表opendata104',aa1,'.csv',sep='')
#######路徑
realpath='C:/Users/TSR/Desktop/各縣市汽車加油站汽柴油銷售統計分析表/'
allpath=paste(realpath,tt1,sep='')
for (j in 1:11){
aaa=readLines(allpath[j],encoding = 'UTF-8')
aaa1=aaa[-c(1:5,28,29)]
aaa2=strsplit(aaa1,split = ',')
#aaa2[[1]] %>% is
#創建資料框
test1=matrix('0',nrow=22,ncol=10)
for (i in 1:22){
test1[i,]=aaa2[[i]]
}
test1 %<>% as.data.frame(.,stringsAsFactors=F)
test1
###names
tablename=c('縣市別','x5','x5-x10','x10-x15','x15-x20','x20-x25','x25-x30'
,'x30-x40','x40','total')
names(test1)=tablename
test1$month=j
if(j==1){
alldata=test1
}else{
alldata=rbind(alldata,test1)
}
}
alldata[,2] %>% is
alldata[,1] %>% is
alldata[,3] %>% is
alldata[,3]
for (i in 2:10){
alldata[,i]=as.numeric(alldata[,i])
}
alldata[,2] %>% is
###向量化
par(mfrow=c(5,5),mar=rep(0.7,4))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot)
aa[,2] %>%   colSums()
aa[,2]
aa[,2:9] %>%   colSums()
alldata %>%　group_by('縣市別') %>%　apply(.,2,sum)
alldata
alldata %>% names
alldata %>%　group_by('縣市別')
alldata %>%　group_by(縣市別)
alldata %>%　group_by(縣市別) %>%　apply(.[,2:9],2,sum) %>%
1
alldata %>%　group_by(縣市別) %>%　apply(.[,2:9],2,sum) %>% bplot
alldata %>%　group_by(縣市別) %>% '['(,2:9)
alldata %>%　group_by(縣市別) %>% '['(,2:9) %>% colSums()
alldata %>%　group_by(縣市別) %>% '['(,2:9) %>% colSums() %>% bplot
alldata %>% '['(,2:9) %>%　group_by(縣市別)
apply(aa, 1, bplot)
par(mfrow=c(5,5),mar=rep(0.7,4))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot)
?summarise
alldata %>%　group_by(縣市別) %>% do(aa=colSums(.[2:9]))
alldata %>%　group_by(縣市別) %>% do(data.frame(aa=colSums(.[2:9]))
)
?do
alldata %>%　group_by(縣市別) %>% do(as.data.frame(aa=colSums(.[2:9]))
)
alldata %>%　group_by(縣市別) %>% do(aa=colSums(.[2:9])
)
g1=alldata %>%　group_by(縣市別) %>% do(aa=colSums(.[2:9]))
g1$aa[[1]]
data.frame(g1$aa[[1]])
data.frame(g1)
g1
g1 %>% dim
g1[,1]
g1[1,]
g1[1,][1]
g1[1,][[1]]
g1[1,][[2]]
g1[1,][[2]][[1]]
test=function(x){
x[[2]][[1]]
}
apply(g1,1,test)
lapply(g1,1,test)
apply(g1,1,test)
g1[1,][[2]][[1]]
g1[1,][2][[1]]
test=function(x){
x[2][[1]]
}
apply(g1,1,test)
g1[1,][2][[1]]
pp1=apply(g1,1,test)
t(pp1)
g1[,1]
cbind(g1[,1],t(pp1))
cbind(g1[,1],t(pp1)) %>% is
test=function(x){
data.frame(x[2][[1]])
}
pp1=apply(g1,1,test)
cbind(g1[,1],t(pp1)) %>% is
apply(g1,1,test)
test=function(x){
x[2][[1]]
}
apply(g1,1,test)
pp1=apply(g1,1,test)
cbind(g1[,1],t(pp1)) %>% is
gsum=cbind(g1[,1],t(pp1))
apply(gsum,1,bplot)
bplot=function(x,max=80){
y=x[2:9]
if(is.vector(y)) y=t(y)
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],x[11],sep='_'),ylim=c(0,max))
}
apply(gsum,1,bplot,max=1000)
par(mfrow=c(5,5),mar=rep(0.7,4))
apply(gsum,1,bplot,max=1000)
g1[1,][2][[1]]
g1[1,][[2]][[1]]
g1[1,2][[1]]
g1[1,2]
g1[1,2][[1]]
g1$aa
data.frame(g1$aa)
matrix(g1$aa)
g1$aa
do.call(g1$aa,rbind)
do.call(rbind,g1$aa)
pp1=do.call(rbind,g1$aa)
gsum=cbind(g1[,1],pp1))
g1[,1]
gsum=cbind(g1[,1],pp1))
gsum=cbind(g1[,1],pp1)
gsum
Reduce(rbind,g1$aa)
Reduce(rbind,g1$aa) %>% is
pp1Reduce(rbind,g1$aa)
gsum=cbind(g1[,1],pp1)
pp1=Reduce(rbind,g1$aa)
gsum=cbind(g1[,1],pp1)
gsum
g1=alldata %>%　group_by(縣市別) %>% do(aa=colSums(.[2:9]))
pp1=do.call(rbind,g1$aa)
gsum=cbind(g1[,1],pp1)
par(mfrow=c(5,5),mar=rep(0.7,4))
apply(gsum,1,bplot,max=1000)
summary(alldata)
apply(gsum,1,bplot,max=1000)
par(mfrow=c(5,5),mar=rep(2,4))
apply(gsum,1,bplot,max=1000)
alldata %>% filter(縣市別=='臺北市') %>% boxplot()
alldata %>% filter(縣市別=='臺北市') %>% '['(2:9) %>%   boxplot()
par(mfrow=c(1,1))
alldata %>% filter(縣市別=='臺北市') %>% '['(2:9) %>%   boxplot()
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9]))
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9]))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(t(.[,2:9]),main=.[1,1]))
alldata %>% filter(縣市別=='桃園縣')
apply(aa, 1, bplot)
apply(gsum,1,bplot,max=1000)
alldata %>% filter(縣市別=='臺北市') %>% '['(2:9) %>%   boxplot()
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(t(.[,2:9]),main=.[1,1]))
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))
library(magrittr)
library(plyr)
library(dplyr)
library(data.table)
require(devEMF)
par(mfrow=c(5,5),mar=rep(0.7,4))
alldata %>% group_by(縣市別) %>% do(dd=boxplot(.[,2:9],main=.[1,1]))
par(mfrow=c(3,4),mar=rep(2,4))
alldata %>% filter(縣市別=='臺中市') %>%
group_by(month) %>% do(ss=bplot(.))
par(mfrow=c(5,5),mar=c(2,.5,1,.5))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot,las=1)
alldata %>%　filter(month==1)
alldata[1,2:9] %>% barplot(height = .)
parnames=alldata %>% names %>%　'['(2:9)
bplot=function(x,max=80,las=1){
y=x[2:9]
if(is.vector(y)) y=t(y)
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],x[11],sep='_'),ylim=c(0,max),las=las)
}
par(mfrow=c(5,5),mar=c(2,.5,1,.5))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot,las=1)
bplot=function(x,max=80,las=1){
y=x[2:9]
if(is.vector(y)) y=t(y)
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],'月份',x[11],sep='_'),ylim=c(0,max),las=las)
}
par(mfrow=c(5,5),mar=c(2,.5,1,.5))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot,las=1)
par(mfrow=c(3,4),mar=rep(2,4))
alldata %>% filter(縣市別=='臺中市') %>%
group_by(month) %>% do(ss=bplot(.))
bplot=function(x,max=80,las=1,mon=''){
y=x[2:9]
if(is.vector(y)) y=t(y)
names(y)=parnames
barplot(as.matrix(y),main=paste(x[1],paste(x[11],mon,sep=''),sep='_'),ylim=c(0,max),las=las)
}
mon=''
paste(x[11],mon,sep='')
par(mfrow=c(5,5),mar=c(2,.5,1,.5))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot,las=1)
apply(aa, 1, bplot,las=1,mon='月份')
par(mfrow=c(3,4),mar=rep(2,4))
alldata %>% filter(縣市別=='臺中市') %>%
group_by(month) %>% do(ss=bplot(.))
alldata %>% filter(縣市別=='臺中市') %>%
group_by(month) %>% do(ss=bplot(.,mon='月份'))
emf('C:/Users/TSR/Desktop/EDA/每個縣市一月份.emf')
par(mfrow=c(5,5),mar=c(2,.5,1,.5))
aa=alldata %>%　filter(month==1)
apply(aa, 1, bplot,las=1,mon='月份')
dev.off()
emf('C:/Users/TSR/Desktop/EDA/臺中每個月.emf')
par(mfrow=c(3,4),mar=rep(2,4))
alldata %>% filter(縣市別=='臺中市') %>%
group_by(month) %>% do(ss=bplot(.,mon='月份'))
dev.off()
par(mfrow=c(5,5),mar=rep(2,4))
aa=testdata %>%　filter(month==1)
apply(aa, 1, bplot,max=.5,mon='月份')
st=function(x){
tt=as.numeric(x[2:9])/as.numeric(x[10])
dd=c(x[1],tt,x[10:11])
names(dd)=names(x)[1:11]
t(dd)
}
ff=apply(alldata,1,st)
testdata=t(ff) %>% as.data.frame(stringsAsFactors =F)
names(testdata)=names(alldata)[1:11]
testdata %>% head
str(testdata)
for (i in 2:11){
testdata[,i]=as.numeric(testdata[,i])
}
str(testdata)
par(mfrow=c(5,5),mar=rep(2,4))
aa=testdata %>%　filter(month==1)
apply(aa, 1, bplot,max=.5,mon='月份')
emf('C:/Users/TSR/Desktop/EDA/各縣市長條圖-標準化.emf')
par(mfrow=c(5,5),mar=rep(2,4))
aa=testdata %>%　filter(month==1)
apply(aa, 1, bplot,max=.5,mon='月份')
dev.off()
library(magrittr)
library(plyr)
library(dplyr)
library(data.table)
alldata[7:20,]
alldata[15:30,]
alldata[70:90,]
alldata[75:95,]
data1=read.table('c:/Users/TSR/Desktop/掏寶資料/掏寶寄件人.txt')
data1
names(data1)=c('日期','姓名','位置')
library(plyr)
library(dplyr)
library(magrittr)
data1[1,1]-data1[2,1]
data1 %>% str
?read.table()
data1=read.table('c:/Users/TSR/Desktop/掏寶資料/掏寶寄件人.txt',stringsAsFactors =F)
data1 %>% str
names(data1)=c('日期','姓名','位置')
data1 %>% str
data1$日期=data1$日期 %>% as.Date()
data1 %>% str
data1[1,1]-data1[2,1]
a=data1[1,1]-data1[2,1]
a %>% is
a %>% str
a+1
a>0
a[1]
a[2]
names(data1)=c('date','name','local')
data1 %>% str
data1$日期=data1$date %>% as.Date()
?arrage
?arrange
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=.$date[1,1]-.$date[2,1])
a
}
savename(data1)
tt=function(x){
if (dim(x)[1]==1) {pp=35
}else{
pp=x$date[1,1]-x$date[2,1]
}
pp
}
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
a
}
savename(data1)
data1 %>% arrange(desc(date))
data1 %>% arrange(desc(date)) %>% group_by(name)
tt=function(x){
if (dim(x)[1]==1) {pp=35
}else{
pp=x$date[1]-x$date[1]
}
pp
}
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
a
}
savename(data1)
aa=savename(data1)
aa$h
tt=function(x){
if (dim(x)[1]==1) {pp=35
}else{
pp=x$date[1]-x$date[2]
}
pp
}
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
a
}
aa=savename(data1)
aa$h
aa$h %>% unlist()
aa$name
tt=function(x){
if (dim(x)[1]==1) {pp=35
}else{
pp=x$date[1]-x$date[2]
}
pp
}
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
a1=a$h %>% unlist()
a$name[a1>34]
}
savename(data1)
Sys.Date()
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=Sys.Date()-.$date[1])
a1=a$h %>% unlist()
a$name[a1>34]
}
savename(data1)
Sys.Date()+180
Sys.Date()>(Sys.Date()+1)
Sys.Date()>(Sys.Date()-30)
tt=function(x){
x1=x %>% select(date>(Sys.Date()-190))
dim(x1)[1]
}
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
}
halfcount(data1)
tt=function(x){
x1=x %>% filter(date>(Sys.Date()-190))
dim(x1)[1]
}
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
}
savename(data1)
halfcount(data1)
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
a
}
savename(data1)
halfcount(data1)
?do
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=as.data.frame(tt(.)))
a
}
savename(data1)
halfcount(data1)
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
cbind(a$name,a$h %>% unlist )
}
savename(data1)
halfcount(data1)
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
cbind(a$name,a$h %>% unlist %>% as.numeric() )
}
savename(data1)
halfcount(data1)
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
data.frame(a$name,a$h %>% unlist %>% as.numeric() )
}
savename(data1)
halfcount(data1)
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=tt(.))
data.frame(name=a$name,count=a$h %>% unlist %>% as.numeric() )
}
savename(data1)
halfcount(data1)
library(plyr)
library(dplyr)
library(magrittr)
data1=read.table('c:/Users/TSR/Desktop/掏寶資料/掏寶寄件人.txt',stringsAsFactors =F)
data1
names(data1)=c('date','name','local')
data1 %>% str
data1$日期=data1$date %>% as.Date()
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=Sys.Date()-.$date[1])
a1=a$h %>% unlist()
a$name[a1>34]
}
subhalf=function(x){
x1=x %>% filter(date>(Sys.Date()-190))
dim(x1)[1]
}
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=subhalf(.))
data.frame(name=a$name,count=a$h %>% unlist %>% as.numeric() )
}
savename(data1)
halfcount(data1)
savename(data1)
data1$日期=data1$date %>% as.Date()
savename(data1)
data1 %>% str
data1$date=data1$date %>% as.Date()
savename=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=Sys.Date()-.$date[1])
a1=a$h %>% unlist()
a$name[a1>34]
}
subhalf=function(x){
x1=x %>% filter(date>(Sys.Date()-190))
dim(x1)[1]
}
halfcount=function(x){
a=data1 %>% arrange(desc(date)) %>% group_by(name) %>% do(h=subhalf(.))
data.frame(name=a$name,count=a$h %>% unlist %>% as.numeric() )
}
savename(data1)
halfcount(data1)
