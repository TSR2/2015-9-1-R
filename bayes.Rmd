---
title: "Untitled"
output: html_document
---


```{r}

data=rbeta(shape1 = 1,shape2 = 1,n=20)
data
?beta
?integrate


######一元方程求解
f1=function(x,a,b) {a+b*x}
a=5
b=10
pp=uniroot(f1,c(-10,10),a=a,b=b,tol=0.00001)
pp
###########


#######  1 failure strategies
a=1;b=1;n=100

kfail=function(a,b,n){
  rb=rbeta(n = n,shape1 = a,shape2 = b)
  list=c()
  p=0
  count=0
  for (i in 1:n){
    taget=rb[i]
    if (length(list)>=n){break}
    for (j in 1:n){
      if (length(list)>=n){break}
      ru=runif(n)
      p=ifelse(test = taget>=ru[j],"S","F")
      list=c(list,p)
      if (taget<ru[j]) {break}
    }
  }
  list
  count=sum(list=="F")/n
  list(log=list,persent=count)
}
kfail(a=1,b=1,n=100)
#######################################

############# m strategies

a=1;b=1;m=3;n=100
mstep=function(a,b,m,n){
  rb=rbeta(n = n,shape1 = a,shape2 = b)
  list=c()
  mtotal=c()
  p=0
  count=0
  for (i in 1:n){
    taget=rb[i]
    scount=0
    if (length(list)>=n){break}
    for (j in 1:n){
      if (length(list)>=n){break}
      ###如果換手臂的次數大於m,則找出成功率最高的做下去
      if (length(mtotal)==m) {taget=rb[which.max(mtotal)]} 
      ru=runif(n)
      ###從beta分配抽出來的如果比uniform大，則給S,反之給F
      p=ifelse(test = taget>=ru[j],"S","F")
      ###收集每次的實驗結果
      list=c(list,p)
      ###累計該手臂成功的次數
      if (taget>ru[j]) {scount=scount+1}
      ####
      if (scount<m){
        ####使用的手臂在m個以下，而且該次實驗是失敗的，記錄下該次實驗的成功總次數
        if (taget<ru[j] & length(mtotal)<m) {
          mtotal=c(mtotal,scount)
          break
          }
        }
      
    }
  }
  list
  persent=sum(list=="F")/n
  mtotal
  list(list,persent,mtotal)
}
mstep(a=1,b=1,m=9,n=100)
v=0
for (i in 1:100){
aa=mstep(a=1,b=1,m=9,n=100)
v=v+aa[[2]]  
}

v/100
totallist[[2]]
rm(list=ls())

#####################################
mstep=function(a,b,N,n){
  rb=rbeta(n = n,shape1 = a,shape2 = b)
  list=c()
  mtotal=c()
  p=0
  count=0
  for (i in 1:n){
    taget=rb[i]
    scount=0
    if (length(list)>=n){break}
    for (j in 1:n){
      if (length(list)>=n){break}
      ###如果換手臂的次數大於m,則找出成功率最高的做下去
      if (length(mtotal)==m) {taget=rb[which.max(mtotal)]} 
      ru=runif(n)
      ###從beta分配抽出來的如果比uniform大，則給S,反之給F
      p=ifelse(test = taget>=ru[j],"S","F")
      ###收集每次的實驗結果
      list=c(list,p)
      ###累計該手臂成功的次數
      if (taget>ru[j]) {scount=scount+1}
      ####
      if (scount<m){
        ####使用的手臂在m個以下，而且該次實驗是失敗的，記錄下該次實驗的成功總次數
        if (taget<ru[j] & length(mtotal)<m) {
          mtotal=c(mtotal,scount)
          break
          }
        }
      
    }
  }
  list
  persent=sum(list=="F")/n
  mtotal
  list(list,persent,mtotal)
}


#############################計算N值
a=1;b=1;n=100;total=0;m=9;
bb=beta(a=a+(0:(n-1)),b=b)
N=(sum(bb)*m)/beta(a,b)

list=list(1:10)
list

list=c(list,list(1:20))
list


y=c(10,11,14,13)
x=cbind(rep(1,4),1:4)
b=solve(t(x) %*% x) %*% t(x) %*%y
x-1
b
x
lm(y~x)
lm(y~x-1)

plot(dnorm(seq(-3,3,by=0.1)),type="l",axes = F)
axis(1,at=seq(1,61,by=10),label=seq(-3,3,by=1))

```


