}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
##########################################
Nkfail=function(a,b,n,N,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
#####x=1?O?N???٥????찵?쩳?????u,x=0?O?N???????F
x=1
for (i in 1:n){
taget=rb[i]
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
#####?b?j??N?H???A?Ĥ@???X?{F?A?P?_???\?v?̰??????u
if (length(mtotal)>=N & p=="F" & x==1) {taget=rb[which.max(mtotal)];x=0}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
if (taget>=ru[j]) {
p="S"
scount=scount+1
}
else p="F"
###?????C???????絲?G
list=c(list,p)
if (taget<ru[j] & x==1) {
mtotal=c(mtotal,scount)
break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
###########################################
runs=function(run,fun,...){
v=rep(0,run)
for (i in 1:run){
v[i]=fun(...)[[2]]
}
mean(v)
}
ifail=function(a=1,b=1,n=100,i=50,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
p=ifelse(test = taget>=ru[j],"S","F")
list=c(list,p)
if (taget<ru[j] & length(list)<i) {break}
}
}
list
count=sum(list=="F")/n
list(log=list,persent=count)
}
j=list()
length(j)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
p=ifelse(test = taget>=ru[j],"S","F")
###?????C???????絲?G
list=c(list,p)
###?֭p?Ӥ??u???\??????
if (taget>ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if (scount<m & scount>(length(mtotal)+1)) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
ifail(a=1,b=1,n=100)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
p=ifelse(test = taget>=ru[j],"S","F")
###?????C???????絲?G
list=c(list,p)
###?֭p?Ӥ??u???\??????
if (taget>ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if (scount<m & scount>(length(mtotal)+1)) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
ifail(a=1,b=1,n=100)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
p=ifelse(test = taget>=ru[j],"S","F")
###?????C???????絲?G
list=c(list,p)
###?֭p?Ӥ??u???\??????
if (taget>ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if (scount>(length(mtotal)+1)) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
runs=function(run,fun,...){
v=rep(0,run)
for (i in 1:run){
v[i]=fun(...)[[2]]
}
mean(v)
}
runs(run = 100,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
pp=1:100
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
p=ifelse(test = taget>=ru[j],"S","F")
###?????C???????絲?G
list=c(list,p)
###?֭p?Ӥ??u???\??????
if (taget>ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if ((j-scount)>i) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
ifail(a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
ifail(a=1,b=1,n=100)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
pp=1:100
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
###?qbeta?��t???X?Ӫ??p?G??uniform?j?A?h??S,?Ϥ???F
p=ifelse(test = taget>=ru[j],"S","F")
###?????C???????絲?G
list=c(list,p)
###?֭p?Ӥ??u???\??????
if (taget>=ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if ((j-scount)>i) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
ifail=function(a=1,b=1,n=100,alpha=0.1,t=0){
if (t==1){rb=createbeta(n,alpha)}
else {rb=rbeta(n = n,shape1 = a,shape2 = b)}
list=c()
mtotal=c()
p=0
count=0
for (i in 1:n){
taget=rb[i]
scount=0
if (length(list)>=n){break}
for (j in 1:n){
if (length(list)>=n){break}
ru=runif(n)
p=ifelse(test = taget>=ru[j],"S","F")
list=c(list,p)
if (taget>=ru[j]) {
scount=scount+1
}else{
mtotal=c(mtotal,scount)
if ((j-scount)>i) break
}
}
}
persent=sum(list=="F")/n
list(list,persent,mtotal)
}
runs=function(run,fun,...){
v=rep(0,run)
for (i in 1:run){
v[i]=fun(...)$persent
}
mean(v)
}
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs(run = 500,fun = ifail,a=1,b=1,n=100)
runs=function(run,fun,...){
v=rep(0,run)
for (i in 1:run){
v[i]=fun(...)[[2]]
}
mean(v)
}
runs(run = 500,fun = ifail,a=1,b=1,n=100)
k=ifail(a=1,b=1,n=100)
k
createbeta(n = 200,v = 0.1)
f=createbeta(n = 200,v = 0.1)
f
mf=mean(f)
vf=var(f)
f=createbeta(n = 200,v = 0.1)
mf=mean(f)
vf=var(f)
ff=function(x,y){
x/(x+y)-mf-(x*y)/((x+y)^2*(x+y+1))+vf
}
nlm(ff,p = c(0,0))
ff=function(z){
x=z[1]
y=z[2]
x/(x+y)-mf-(x*y)/((x+y)^2*(x+y+1))+vf
}
nlm(ff,p = c(0,0))
f=createbeta(n = 200,v = 0.1)
mf=mean(f)
vf=var(f)
ff=function(z){
x=z[1]
y=z[2]
(x/(x+y)-mf-(x*y)/((x+y)^2*(x+y+1))+vf)^2
}
nlm(ff,p = c(0,0))
optim(c(1,2),ff)
jj=optim(c(1,2),ff)
jj[[1]]
b1=jj[[1]][1]
b2=jj[[1]][2]
b1/(b1+b2)
mf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
vf
nlm(ff,p = c(0,0))
nlm(ff,p = c(1,2))
ll=nlm(ff,p = c(1,2))
b1=ll[[2]][1]
b2=ll[[2]][2]
b1/(b1+b2)
(b1*b2)/((b1+b2)^2*(b1+b2+1))
mf
vf
?nlm
ll=nlm(ff,p = c(1,2),gradtol = 1e-12)
b1=ll[[2]][1]
b2=ll[[2]][2]
b1/(b1+b2)
(b1*b2)/((b1+b2)^2*(b1+b2+1))
ll=nlm(ff,p = c(1,2),gradtol = 1e-20)
b1=ll[[2]][1]
b2=ll[[2]][2]
b1/(b1+b2)
(b1*b2)/((b1+b2)^2*(b1+b2+1))
?optimize
?nlm
?optim
Rprof()
invisible(  mstep(a=1,b=1,m=31,n=1000)  )
Rprof(NULL)
summaryRprof()
EX=function(a){
1-4^a*(gamma(1+a)^2/gamma(2+2*a))
}
EX2=function(a){
(2+a/1+a)-2^(1+2*a)*(gamma(1+a)^2/gamma(2+2*a))
}
EX(0.9)
betamean=function(a,b){
a/(a+b)
}
sol=function(a,b,aphla){
betamean(a,b)-EX(aphla)
}
uniroot(f = sol,a=1,aphla=0.9,interval = c(0,5),tol=0.001)
TL=function(x,a,j){
x^j*2*a*(1 - x)*x^(a-1)*(2 - x)^(a-1)
}
aaa=function(a,j){
integrate(TL,lower = 0,upper = 1,a=a,j=j)[[1]]
}
n=100;a=0.9
rn=(2*n*a)^(1/3)
kn=((n*sqrt(pi))/(4*sqrt(a)))^(2/3)
kn=floor(kn)
Nn=kn*sum(sapply(0:(n-1),aaa,a=0.9))
EX(0.9)
ll=nlm(ff,p = c(1,2),gradtol = 1e-20)
ll
mf
b1/(b1+b2)
vf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
ll=nlm(ff,p = c(1,2),gradtol = 1e-20)
b1=ll[[2]][1]
b2=ll[[2]][2]
mf
b1/(b1+b2)
vf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
rn
kn
Nn
kn
runs(run = 200,fun = mstep,a=b1,b=b2,m=kn,n=500)
f=createbeta(n = 200,v = 0.9)
mf=mean(f)
vf=var(f)
ff=function(z){
x=z[1]
y=z[2]
(x/(x+y)-mf-(x*y)/((x+y)^2*(x+y+1))+vf)^2
}
ll=nlm(ff,p = c(1,2),gradtol = 1e-20)
jj=optim(c(1,2),ff)
b1=ll[[2]][1]
b2=ll[[2]][2]
mf
b1/(b1+b2)
vf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
runs(run = 200,fun = mstep,a=b1,b=b2,m=kn,n=500)
runs(run = 200,fun = mstep,alpha=0.9,m=kn,n=500,t=1)
mf
b1/(b1+b2)
vf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
f=createbeta(n = 200,v = 0.9)
mf=mean(f)
vf=var(f)
ff=function(z){
x=z[1]
y=z[2]
(x/(x+y)-mf)^2+((x*y)/((x+y)^2*(x+y+1))-vf)^2
}
ll=nlm(ff,p = c(1,2),gradtol = 1e-20)
jj=optim(c(1,2),ff)
b1=ll[[2]][1]
b2=ll[[2]][2]
mf
b1/(b1+b2)
vf
(b1*b2)/((b1+b2)^2*(b1+b2+1))
runs(run = 200,fun = mstep,a=b1,b=b2,m=kn,n=500)
runs(run = 200,fun = mstep,alpha=0.9,m=kn,n=500,t=1)
betavar=function(a,b){
(a*b)/((a+b)^2*(a+b+1))
}
uniroot(betamean,c(0,1),a=b1)
b1
bb=function(a,b){
a/(a+b)-mf
}
uniroot(betamean,c(0,1),a=b1)
bb=function(a,b){
a/(a+b)-mf
}
uniroot(betamean,c(0,10),a=b1)
mf
b1
b2
bb=function(a,b){
a/(a+b)-mf
}
uniroot(betamean,c(0,100),a=b1)
bb=function(a,b){
a/(a+b)-mf
}
uniroot(bb,c(0,10),a=b1)
mm=uniroot(bb,c(0,10),a=0.5)
mm$root
betavar(0.5,mm$root)
vf
runs(run = 200,fun = mstep,a=0.5,b=mm$root,m=kn,n=500)
runs(run = 200,fun = mstep,alpha=0.9,m=kn,n=500,t=1)
a=0.1
mm=uniroot(bb,c(0,10),a=a)
mm$root
betavar(a,mm$root)
vf
bb=function(a,b){
a/(a+b)-mf
}
a=2
mm=uniroot(bb,c(0,10),a=a)
mm$root
betavar(a,mm$root)
vf
runs(run = 200,fun = mstep,a=a,b=mm$root,m=kn,n=500)
runs(run = 200,fun = mstep,alpha=0.9,m=kn,n=500,t=1)
sample(1:50)
sample(1:50,1)
sample(1:50,2)
sample(1:50,1)
sample(1:50,2)
sample(1:50,2)
